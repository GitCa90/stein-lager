const data = {
    smågatestein: [
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 10,
            width: 10,
            height: 10,
            amount: 60,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/637dce97f6656b88d378c885_Beer-Mix_smågatestein_brostein_4.jpg",
            note: `Dette er en laaaang merknad...
            Dette er en laaaang merknad....
            Dette er en laaaang merknad...
            .Dette er en laaaang merknad....
            Dette er en laaaang merknad....Dette er en 
            laaaang merknad....Dette er en laaaang merknad....
            Dette er en laaaang merknad....Dette er en laaaang
             merknad....Dette er en laaaang merknad....Her er slutten på teksten`,
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 10,
            width: 10,
            height: 8,
            amount: 87,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/234242421342.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 11,
            width: 11,
            height: 8,
            amount: 20,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/3423424323235234.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 12,
            width: 12,
            height: 12,
            amount: 20,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/ewr3er324524234234.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 10,
            width: 10,
            height: 10,
            amount: 75,
            color: "Grå",
            surface: "Saget",
            origin: "Ruten",
            stored: "Sviland",
            image: "smågatestein/fwf23e2d.jpg",
            note: "Her kan vi skrive ekstra informasjon om steinen...",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 8,
            width: 8,
            height: 8,
            amount: 13,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/3423424323235234.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 100,
            width: 100,
            height: 100,
            amount: 27,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "smågatestein/637dce97f6656b88d378c885_Beer-Mix_smågatestein_brostein_4.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 100,
            width: 100,
            height: 80,
            amount: 5,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "",
            image: "smågatestein/234242421342.jpg",
            note: "",
        },
        {
            name: "Smågatestein",
            material: "Granitt",
            length: 10,
            width: 10,
            height: 10,
            amount: 5,
            color: "Grå",
            surface: "Saget",
            origin: "Ruten",
            stored: "Sviland",
            image: "smågatestein/fwf23e2d.jpg",
            note: "Her kan vi skrive ekstra informasjon om steinen...",
        },
    ],

    storgatestein: [
        {
            name: "Storgatestein",
            material: "Granitt",
            length: 200,
            width: 140,
            height: 140,
            amount: 67,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "storgatestein/ce3werouu23440u23.jpg",
            note: "",
        },
        {
            name: "Storgatestein",
            material: "Granitt",
            length: 200,
            width: 140,
            height: 140,
            amount: 67,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "storgatestein/dqwqw2332342342.jpg",
            note: "",
        },
        {
            name: "Storgatestein",
            material: "Granitt",
            length: 200,
            width: 140,
            height: 140,
            amount: 67,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "storgatestein/storgate3.jpg",
            note: "",
        },
        {
            name: "Storgatestein",
            material: "Granitt",
            length: 200,
            width: 140,
            height: 140,
            amount: 13,
            color: "Brun",
            surface: "",
            origin: "Lura Skole",
            stored: "Sviland",
            image: "storgatestein/storgate4.jpg",
            note: "Ble tatt opp på lura skole 2014",
        },
        {
            name: "Storgatestein",
            material: "Granitt",
            length: 200,
            width: 140,
            height: 140,
            amount: 13,
            color: "Hvit",
            surface: "Sagt",
            origin: "Hana",
            stored: "Vatne",
            image: "storgatestein/storgatestein5.jpg",
            note: "Fra porsholen 2020",
        },
    ],

    belegningsstein: [
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 20,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/34242342.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 17,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/23425623424.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 15,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/34242342.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 13,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/23425623424.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 35,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/34242342.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 10,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/23425623424.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 9,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/34242342.jpg",
            note: "",
        },
        {
            name: "Belegningsstein",
            material: "Betong",
            length: 200,
            width: 100,
            height: 6,
            amount: 7,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "belegningsstein/23425623424.jpg",
            note: "",
        },
    ],

    tegl: [
        {
            name: "Tegl",
            material: "Keramisk",
            length: 22,
            width: 11,
            height: 5,
            amount: 85,
            color: "Brun",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "tegl/23423desf24.jpg",
            note: "",
        },
        {
            name: "Tegl",
            material: "Keramisk",
            length: 20,
            width: 10,
            height: 6,
            amount: 140,
            color: "Brun",
            surface: "",
            origin: "",
            stored: "Vatne",
            image: "tegl/tegl2.jpg",
            note: "",
        },
        {
            name: "Tegl",
            material: "Keramisk",
            length: 20,
            width: 11,
            height: 5,
            amount: 15,
            color: "Brun",
            surface: "",
            origin: "",
            stored: "Vatne",
            image: "tegl/tegl3.jpg",
            note: "",
        },
    ],

    heller: [
        {
            name: "Heller",
            material: "Betong",
            length: 60,
            width: 60,
            height: 5,
            amount: 50,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "heller/34234121.jpg",
            note: "",
        },
        {
            name: "Heller",
            material: "Betong",
            length: 30,
            width: 30,
            height: 2,
            amount: 20,
            color: "Grå",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "heller/321492+408.jpg",
            note: "",
        },
        {
            name: "Heller",
            material: "Betong",
            length: 60,
            width: 60,
            height: 12,
            amount: 220,
            color: "Grå",
            surface: "Ruglete",
            origin: "",
            stored: "Vatne",
            image: "heller/heller5.jpg",
            note: "",
        },
    ],

    kantstein: [
        {
            name: "Kantstein",
            material: "Granitt",
            length: 1000,
            width: 120,
            height: 250,
            amount: 200,
            color: "Hvit",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "kantstein/23e23e232523e2.jpg",
            note: "",
        },
        {
            name: "Kantstein",
            material: "Granitt",
            length: 1000,
            width: 120,
            height: 250,
            amount: 200,
            color: "Hvit",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "kantstein/kantstein5.jpg",
            note: "",
        },
    ],

    kurvestein: [
        {
            name: "Kurvestein",
            material: "Granitt",
            length: 1000,
            width: 30,
            height: 20,
            amount: 27,
            color: "Hvit",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "kurvestein/kurvestein1.jpg",
            note: "",
        },
        {
            name: "Kurvestein",
            material: "Granitt",
            length: 1000,
            width: 30,
            height: 20,
            amount: 15,
            color: "Hvit",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "kurvestein/kurvestein2.jpg",
            note: "",
        },
    ],

    platekant: [
        {
            name: "Platekant",
            material: "Granitt",
            length: 1000,
            width: 30,
            height: 20,
            amount: 35,
            color: "Hvit",
            surface: "",
            origin: "",
            stored: "Sviland",
            image: "platekant/3123131.jpg",
            note: "",
        },
    ],
}

const materialList = [
    "smågatestein", "storgatestein", "belegningsstein", "tegl",
    "heller", "kantstein", "kurvestein", "platekant"
];

const sortSettings = {
    smågatestein: "Index",
    storgatestein: "Index",
    belegningsstein: "Index",
    tegl: "Index",
    heller: "Index",
    kantstein: "Index",
    kurvestein: "Index",
    platekant: "Index"
};

const sortNameMap = {
    "Index": "index",
    "Lengde": "length",
    "Bredde": "width",
    "Høyde": "height",
    "Mengde": "amount"
};


const template = document.querySelector("#material-template");
function createWindowDOM(nodelist) {
    const fragment = document.createDocumentFragment()

    nodelist.forEach((item, index) => {
        const mainDiv = document.createElement("div")
        const textDiv = document.createElement("div")
        const image = document.createElement("img")

        mainDiv.id = `${item.name}_${index}`
        mainDiv.classList.add("image")
        mainDiv.dataset.material = item.name.toLowerCase()
        mainDiv.dataset.index = index

        textDiv.classList.add("item-text")
        textDiv.textContent = `${item.length} x ${item.width} x ${item.height} | ` + squareMeterOrMeter(item)

        image.src = item.image

        mainDiv.append(textDiv, image)
        fragment.append(mainDiv)
    })
    return fragment
}

function makeWindows() {
    const container = document.getElementById("main-container")

    materialList.forEach(material => {
        const dataArray = data[material]
        if (!dataArray || dataArray.length === 0 || !dataArray[0].name) return;

        const clone = template.content.cloneNode(true)

        clone.querySelector(".material-section").dataset.material = material
        clone.querySelector(".minimize-btn").dataset.material = material
        clone.querySelector(".sort-btn").dataset.material = material
        clone.querySelector(".sort-btn").textContent = `Sortèr: ${sortSettings[material]}`
        clone.querySelector(".sort-menu").dataset.material = material
        clone.querySelectorAll(".sort-setting").forEach(type => type.dataset.material = material)
        clone.querySelector(".ascending-btn").dataset.material = material
        clone.querySelector(".section-label").textContent = material[0].toUpperCase() + material.slice(1)
        clone.querySelector(".item-line").dataset.material = material

        clone.querySelector(".item-line").append(createWindowDOM(dataArray))
        clone.querySelectorAll(".image").forEach(image => image.dataset.material = material)

        container.append(clone)
    })
}

const originalData = JSON.parse(JSON.stringify(data));
function sortWindows(materialName, setting) {
    const ascendButton = document.querySelector(`.ascending-btn[data-material="${materialName}"]`)
    const property = sortNameMap[setting] || setting

    if (property == "index") {
        if (ascendButton.textContent == "↓") {
            data[materialName] = [...originalData[materialName]];
        } else {
            data[materialName] = [...originalData[materialName]].reverse();
        }

    } else {
        if (ascendButton.textContent == "↑") {
            data[materialName].sort((a, b) => a[property] - b[property])
        } else {
            data[materialName].sort((a, b) => b[property] - a[property])
        }
    }

    const container = document.querySelector(`.item-line[data-material="${materialName}"]`)
    container.innerHTML = "";
    container.append(createWindowDOM(data[materialName]));
}

function squareMeterOrMeter(element) {
    if (
        element.name == "Smågatestein" ||
        element.name == "Belegningsstein" ||
        element.name == "Tegl" ||
        element.name == "Heller"
    ) {
        return `${element.amount}m²`
    } else {
        return `${element.amount}m`
    }
}

function minimizeButton(element) {
    const materialName = element.dataset.material
    const section = document.querySelector(`.material-section[data-material="${materialName}"]`)
    const container = section.querySelector(".item-line")

    const collapsed = container.classList.toggle("collapsed-line")

    element.textContent = collapsed ? "+" : "-"
}

function openSortMenu(element) {
    const materialName = element.dataset.material
    const sortMenu = document.querySelector(`.sort-menu[data-material="${materialName}"]`)
    const allMenus = document.querySelectorAll(".sort-menu")

    allMenus.forEach(menu => {
        if (menu.dataset.material !== materialName) {
            menu.classList.remove("sort-menu-open")
        }
    })

    sortMenu.classList.toggle("sort-menu-open");
}

function onSortSettingSelect(element) {
    const materialName = element.dataset.material
    const setting = element.dataset.sort

    highlightSortType(element)
    sortWindows(materialName, setting)

    sortSettings[materialName] = setting

    const sortButton = document.querySelector(`.sort-btn[data-material="${materialName}"]`)
    const settingText = document.querySelector(`.sort-setting[data-sort="${setting}"][data-material="${materialName}"]`).textContent
    sortButton.textContent = `Sortèr: ${settingText}`

    document.querySelectorAll(".sort-menu").forEach(menu => menu.classList.remove("sort-menu-open"));
}

function highlightSortType(element) {
    const materialName = element.dataset.material
    const sortSetting = document.querySelectorAll(`.sort-setting[data-material="${materialName}"]`)

    sortSetting.forEach(setting => setting.classList.remove("sort-setting-active"));
    element.classList.add("sort-setting-active")
}

function closeSortMenu(element) {
    const button = element.target.closest(".sort-btn");
    const menu = element.target.closest(".sort-menu");

    if (!button && !menu) {
        document.querySelectorAll(".sort-menu").forEach(menu => {
            menu.classList.remove("sort-menu-open");

        });
    }
}

function ascendingButton(element) {
    const materialName = element.dataset.material

    element.textContent = element.textContent == "↓" ? "↑" : "↓";

    sortWindows(materialName, sortSettings[materialName])
}

function onImageSelect(element) {
    const materialName = element.dataset.material
    const index = element.dataset.index

    imageSelectBorder(materialName, index)
    displayInfo(data[materialName][index])
}

function imageSelectBorder(materialName, index) {
    const selectedImage = document.querySelector(`.image[data-material="${materialName}"][data-index="${index}"]`)
    const allImages = document.querySelectorAll(".image")

    allImages.forEach((image) => image.classList.remove("selected"))
    selectedImage.classList.add("selected")
}

function displayInfo(currentObject) {
    let image = document.getElementById("info-image")
    let name = document.getElementById("info-name")
    let material = document.getElementById("info-material")
    let dimensions = document.getElementById("info-dimensions")
    let amount = document.getElementById("info-amount")
    let color = document.getElementById("info-color")
    let surface = document.getElementById("info-surface")
    let origin = document.getElementById("info-origin")
    let stored = document.getElementById("info-stored")
    let note = document.getElementById("info-note")

    image.src = currentObject.image
    name.textContent = `Type: ${currentObject.name}`
    material.textContent = `Materiale: ${currentObject.material}`
    dimensions.textContent = `Dimensjoner: ${currentObject.length} x ${currentObject.width} x ${currentObject.height}`
    amount.textContent = `Mengde: ${squareMeterOrMeter(currentObject)}`
    color.textContent = `Farge: ${currentObject.color}`
    surface.textContent = `Overflatebehandling: ${currentObject.surface}`
    origin.textContent = `Opprinnelse: ${currentObject.origin}`
    stored.textContent = `Lagret på: ${currentObject.stored}`
    note.textContent = `Merknad: ${currentObject.note}`
}

function onButtonDown(element) {
    element.style.transform = "scale(0.90)";
}

function onButtonUp(element) {
    element.style.transform = "scale(1)";
}

function init() {
    makeWindows();
    document.querySelectorAll(`.sort-setting[data-sort="index"]`).forEach(index => index.classList.add("sort-setting-active"))
}

init()




document.addEventListener("click", (event) => {

    closeSortMenu(event)

    const minButtonElement = event.target.closest(".minimize-btn")
    if (minButtonElement) {
        minimizeButton(minButtonElement)
    }

    const sortButtonElement = event.target.closest(".sort-btn")
    if (sortButtonElement) {
        openSortMenu(sortButtonElement);
    }

    const sortSettingElement = event.target.closest(".sort-setting")
    if (sortSettingElement) {
        onSortSettingSelect(sortSettingElement)
    }

    const imageElement = event.target.closest(".image");
    if (imageElement) {
        onImageSelect(imageElement);
    }

    const ascendButtonElement = event.target.closest(".ascending-btn")
    if (ascendButtonElement) {
        ascendingButton(ascendButtonElement);
    }
})

document.addEventListener("mousedown", (event) => {

    const minimizeButton = event.target.closest(".minimize-btn")
    const sortButton = event.target.closest(".sort-btn")
    const ascendingButton = event.target.closest(".ascending-btn")

    if (minimizeButton) onButtonDown(minimizeButton)
    if (sortButton) onButtonDown(sortButton)
    if (ascendingButton) onButtonDown(ascendingButton)
})

document.addEventListener("mouseup", (event) => {

    const minimizeButton = event.target.closest(".minimize-btn")
    const sortButton = event.target.closest(".sort-btn")
    const ascendingButton = event.target.closest(".ascending-btn")

    if (minimizeButton) onButtonUp(minimizeButton)
    if (sortButton) onButtonUp(sortButton)
    if (ascendingButton) onButtonUp(ascendingButton)
})

const bigImage = document.getElementById("info-image");
const overlay = document.getElementById("image-overlay");
const overlayImg = document.getElementById("overlay-img");
bigImage.addEventListener("click", () => {

    overlayImg.src = bigImage.src;
    overlay.style.display = "flex";

    overlayImg.style.width = "";
    overlayImg.style.height = "";

    overlayImg.onload = () => {
        const w = overlayImg.naturalWidth;
        const h = overlayImg.naturalHeight;

        if (w > h) {
            overlayImg.style.width = "80vw";
            overlayImg.style.height = "auto";

        } else {
            overlayImg.style.height = "50vh";
            overlayImg.style.width = "auto";
        }
    };
});

overlay.addEventListener("click", () => {
    overlay.style.display = "none";
});
